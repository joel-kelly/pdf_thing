<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PDF Tool</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header id="header">
      <div class="header-left">
        <h1>PDF Tool</h1>
        <span id="file-name"></span>
      </div>
      <div class="header-center">
        <div id="zoom-controls" class="hidden">
          <button id="zoom-out-btn" class="header-btn" title="Zoom Out">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M19,13H5V11H19V13Z"/>
            </svg>
          </button>
          <select id="zoom-select">
            <option value="fit">Fit Width</option>
            <option value="0.5">50%</option>
            <option value="0.75">75%</option>
            <option value="1" selected>100%</option>
            <option value="1.25">125%</option>
            <option value="1.5">150%</option>
            <option value="2">200%</option>
          </select>
          <button id="zoom-in-btn" class="header-btn" title="Zoom In">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="header-right">
        <span id="page-indicator" class="hidden">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
      </div>
    </header>

    <!-- Main Content Area -->
    <div id="main-content">
      <!-- File Upload Area (shown when no PDF loaded) -->
      <div id="upload-area" class="dropzone">
        <div class="dropzone-content">
          <svg viewBox="0 0 24 24" width="64" height="64" fill="currentColor">
            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"/>
          </svg>
          <p>Drop PDF here or click to upload</p>
          <span class="hint">Maximum file size: 50MB</span>
        </div>
        <input type="file" id="file-input" accept=".pdf" hidden>
      </div>

      <!-- PDF Viewer (shown when PDF is loaded) -->
      <div id="pdf-viewer-container" class="hidden">
        <div id="pdf-viewer">
          <!-- Pages will be rendered here -->
        </div>
      </div>

      <!-- Tools Panel (right sidebar) -->
      <div id="tools-panel" class="hidden">
        <!-- Page Tools -->
        <div class="tool-group">
          <div class="tool-group-header" data-group="page-tools">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            <span>Page Tools</span>
            <svg class="chevron" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
            </svg>
          </div>
          <div class="tool-group-content" id="page-tools-content">
            <p class="tool-hint">Tools apply to current visible page</p>
            <button class="tool-btn" id="rotate-left-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"/>
              </svg>
              Rotate Left
            </button>
            <button class="tool-btn" id="rotate-right-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M11.5,8C14.15,8 16.55,9 18.4,10.6L22,7V16H13L16.62,12.38C15.23,11.22 13.46,10.5 11.5,10.5C7.96,10.5 4.95,12.81 3.9,16L1.53,15.22C2.92,11.03 6.85,8 11.5,8Z"/>
              </svg>
              Rotate Right
            </button>
            <button class="tool-btn" id="delete-page-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
              </svg>
              Delete Page
            </button>
            <button class="tool-btn" id="extract-page-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
              </svg>
              Extract Page
            </button>
          </div>
        </div>

        <!-- Document Tools -->
        <div class="tool-group">
          <div class="tool-group-header" data-group="document-tools">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M6,2A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M6,4H13V9H18V20H6M8,12V14H16V12M8,16V18H13V16"/>
            </svg>
            <span>Document Tools</span>
            <svg class="chevron" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
            </svg>
          </div>
          <div class="tool-group-content" id="document-tools-content">
            <button class="tool-btn" id="merge-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z"/>
              </svg>
              Merge PDFs
            </button>
            <button class="tool-btn" id="split-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M14,4L8,4L8,8L14,8M20,20L14,20L14,16L20,16M20,4L14.5,4L14.5,8L20,8M8,20L8,16L2,16L2,20M8,14L2,14L2,10L8,10M20,14L14,14L14,10L20,10M8,8V4L2,4L2,8M14,14L8,14L8,10L14,10M14,20L8,20L8,16L14,16"/>
              </svg>
              Split Document
            </button>
            <button class="tool-btn" id="reorder-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M3,15H21V13H3V15M3,19H21V17H3V19M3,11H21V9H3V11M3,5V7H21V5H3Z"/>
              </svg>
              Reorder Pages
            </button>
          </div>
        </div>

        <!-- Redact Tools -->
        <div class="tool-group">
          <div class="tool-group-header" data-group="redact-tools">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M2,4V6H4V4H2M4,2H2A2,2 0 0,0 0,4V6H4V4H6V2H4M22,4V6H20V4H22M20,2H22A2,2 0 0,1 24,4V6H20V4H18V2H20M2,20V18H4V20H2M4,22H2A2,2 0 0,1 0,20V18H4V20H6V22H4M22,20V18H20V20H22M20,22H22A2,2 0 0,0 24,20V18H20V20H18V22H20M8,6H16V8H8V6M8,10H16V12H8V10M8,14H12V16H8V14Z"/>
            </svg>
            <span>Redact</span>
            <svg class="chevron" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
            </svg>
          </div>
          <div class="tool-group-content" id="redact-tools-content">
            <button class="tool-btn toggle-btn" id="redact-mode-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
              </svg>
              Mark for Redaction
            </button>
            <button class="tool-btn" id="apply-redaction-btn" disabled>
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
              </svg>
              Apply Redactions
            </button>
            <button class="tool-btn" id="clear-redactions-btn" disabled>
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
              </svg>
              Clear Redactions
            </button>
            <p class="tool-warning">Redacted pages will be converted to images</p>
          </div>
        </div>

        <!-- Sign Tools -->
        <div class="tool-group">
          <div class="tool-group-header" data-group="sign-tools">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M21.04 12.13c-.14 0-.28.06-.39.17l-1 1 2.05 2.05 1-1c.22-.22.22-.56 0-.78l-1.27-1.27a.55.55 0 00-.39-.17m-1.97 1.75L13 19.94V22h2.06l6.06-6.06-2.05-2.06M10 21H5c-1.11 0-2-.89-2-2V5c0-1.11.89-2 2-2h9l5 5v2h-2V9h-4V5H5v14h5v2z"/>
            </svg>
            <span>Sign</span>
            <svg class="chevron" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
            </svg>
          </div>
          <div class="tool-group-content" id="sign-tools-content">
            <button class="tool-btn" id="add-signature-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
              </svg>
              Add Signature
            </button>
            <div id="signature-quick-list">
              <!-- Saved signatures will appear here -->
            </div>
            <label class="checkbox-label" id="timestamp-option">
              <input type="checkbox" id="add-timestamp-check" checked>
              Add timestamp
            </label>
          </div>
        </div>

        <!-- Download Button (always at bottom) -->
        <div class="tool-group download-section">
          <button class="tool-btn primary" id="download-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
            </svg>
            Download PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="hidden">
      <div id="modal-container">
        <div class="modal-header">
          <h3 id="modal-title">Modal Title</h3>
          <button class="modal-close-btn" id="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Modal content will be inserted here -->
        </div>
        <div class="modal-footer" id="modal-footer">
          <!-- Modal buttons will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Signature Placement Overlay -->
    <div id="signature-placement-overlay" class="hidden">
      <div class="placement-controls">
        <button id="confirm-placement-btn" class="placement-btn primary">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
          </svg>
          Place
        </button>
        <button id="cancel-placement-btn" class="placement-btn">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
          Cancel
        </button>
        <button id="rotate-sig-left" class="placement-btn" title="Rotate Left">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"/>
          </svg>
        </button>
        <button id="rotate-sig-right" class="placement-btn" title="Rotate Right">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M11.5,8C14.15,8 16.55,9 18.4,10.6L22,7V16H13L16.62,12.38C15.23,11.22 13.46,10.5 11.5,10.5C7.96,10.5 4.95,12.81 3.9,16L1.53,15.22C2.92,11.03 6.85,8 11.5,8Z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden">
      <div class="spinner"></div>
      <p id="loading-text">Processing...</p>
    </div>
  </div>

  <!-- Hidden file inputs -->
  <input type="file" id="merge-input" accept=".pdf" multiple hidden>
  <input type="file" id="signature-file-input" accept="image/png,image/jpeg" hidden>

  <!-- Scripts -->
  <script src="../libs/pdf-lib.min.js"></script>
  <script src="../libs/pdf.js"></script>
  <script src="pdf-init.js"></script>
  <script src="../src/file-handler.js"></script>
  <script src="../src/pdf-operations.js"></script>
  <script src="../src/signature-manager.js"></script>
  <script src="../src/redaction.js"></script>
  <script src="../src/modal-manager.js"></script>
  <script src="../src/viewer.js"></script>
  <script src="../src/tools-panel.js"></script>
  <script src="../src/ui-handler.js"></script>
  <script src="popup.js"></script>
</body>
</html>
